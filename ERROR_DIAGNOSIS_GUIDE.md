# 회원가입 오류 상세 진단 가이드

## 정책이 있는데도 오류가 발생하는 경우

정책이 올바르게 설정되어 있는데도 "Database error saving new user" 오류가 발생한다면, 다음을 확인하세요.

## 1단계: 브라우저 콘솔에서 실제 오류 확인

1. **개발자 도구 열기** (F12)
2. **Console 탭** 선택
3. **회원가입 시도**
4. **빨간색 오류 메시지** 확인

다음 정보를 확인하세요:
- **오류 코드** (예: `42501`, `23505`, `23502` 등)
- **오류 메시지** (전체 메시지)
- **Error details** 객체의 내용

## 2단계: Network 탭에서 확인

1. **Network 탭** 선택
2. **회원가입 시도**
3. `/rest/v1/users` 요청 찾기
4. **Response** 탭에서 실제 오류 메시지 확인

## 3단계: Supabase에서 심화 진단

`supabase/deep-diagnosis.sql` 파일을 실행하여 다음을 확인:

### 확인 사항:

1. **제약 조건 확인**
   - UNIQUE 제약 조건 (이메일 중복)
   - NOT NULL 제약 조건
   - CHECK 제약 조건

2. **이메일 중복 확인**
   - 회원가입 시도하는 이메일이 이미 존재하는지 확인

3. **트리거 확인**
   - users 테이블에 트리거가 있는지 확인
   - 트리거가 오류를 발생시키는지 확인

## 일반적인 오류 코드와 해결 방법

### 오류 코드: `42501` (권한 거부)
**원인**: RLS 정책 문제
**해결**: 정책이 올바르게 설정되어 있는지 다시 확인

### 오류 코드: `23505` (UNIQUE 제약 조건 위반)
**원인**: 이메일이 이미 존재함
**해결**: 다른 이메일 사용 또는 기존 계정 확인

### 오류 코드: `23502` (NOT NULL 제약 조건 위반)
**원인**: 필수 필드가 누락됨
**해결**: 회원가입 폼에서 모든 필수 필드 입력 확인

### 오류 코드: `23514` (CHECK 제약 조건 위반)
**원인**: 데이터가 제약 조건을 만족하지 않음
**해결**: 입력 데이터 형식 확인

## 실제 오류 메시지 공유

다음 정보를 공유해주시면 더 정확한 진단이 가능합니다:

1. **브라우저 콘솔의 오류 메시지** (전체)
2. **오류 코드**
3. **Network 탭의 Response 내용**
4. **회원가입 시도하는 이메일** (테스트용)

## 추가 확인 사항

### Supabase Auth 설정 확인
1. **Authentication** → **Settings**
2. **Email Auth** 활성화 확인
3. **Confirm email** 설정 확인 (비활성화 권장)

### 환경 변수 확인
`.env.local` 파일 확인:
```
NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
```

### Supabase 로그 확인
1. **Dashboard** → **Logs**
2. **API Logs** 또는 **Postgres Logs** 확인
3. 회원가입 시도 시점의 로그 확인

